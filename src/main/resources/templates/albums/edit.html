<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="~{fragments/layout :: head('Modifier l\'Album')}">
    <title>Modifier l'Album - FotoShare</title>
</head>
<body class="bg-light d-flex flex-column min-vh-100">
    <!-- Navigation -->
    <nav th:replace="~{fragments/layout :: navbar}"></nav>

    <div class="container py-4 flex-grow-1">
        <!-- Alert messages -->
        <div th:replace="~{fragments/layout :: alerts}"></div>

        <!-- Page Header -->
        <div class="mb-4">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a th:href="@{/}">Accueil</a></li>
                    <li class="breadcrumb-item"><a th:href="@{/albums}">Albums</a></li>
                    <li class="breadcrumb-item">
                        <a th:href="@{/albums/view/{id}(id=${album.id})}" th:text="${album.name}">Album</a>
                    </li>
                    <li class="breadcrumb-item active" aria-current="page">Modifier</li>
                </ol>
            </nav>
            <h2><i class="bi bi-pencil-square me-2"></i>Modifier l'album</h2>
            <p class="text-muted">Modifiez les informations de votre album</p>
        </div>

        <!-- Album Edit Form -->
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card shadow-sm border-0">
                    <div class="card-body p-4">
                        <form th:action="@{/albums/edit/{id}(id=${album.id})}" 
                              th:object="${album}" 
                              method="post"
                              class="needs-validation" 
                              novalidate>
                            
                            <!-- Album Name -->
                            <div class="mb-4">
                                <label for="name" class="form-label fw-bold">
                                    Nom de l'album <span class="text-danger">*</span>
                                </label>
                                <input type="text" 
                                       class="form-control form-control-lg" 
                                       id="name"
                                       th:field="*{name}"
                                       th:classappend="${#fields.hasErrors('name')} ? 'is-invalid'"
                                       placeholder="Ex: Vacances d'été 2024"
                                       maxlength="100"
                                       required>
                                <div class="invalid-feedback" th:if="${#fields.hasErrors('name')}" th:errors="*{name}">
                                    Erreur sur le nom
                                </div>
                                <div class="invalid-feedback" th:unless="${#fields.hasErrors('name')}">
                                    Veuillez saisir un nom pour l'album
                                </div>
                                <div class="form-text">
                                    <i class="bi bi-info-circle me-1"></i>
                                    Maximum 100 caractères
                                </div>
                            </div>

                            <!-- Album Description -->
                            <div class="mb-4">
                                <label for="description" class="form-label fw-bold">
                                    Description
                                </label>
                                <textarea class="form-control" 
                                          id="description"
                                          th:field="*{description}"
                                          th:classappend="${#fields.hasErrors('description')} ? 'is-invalid'"
                                          rows="4"
                                          placeholder="Décrivez votre album (optionnel)"
                                          maxlength="500"></textarea>
                                <div class="invalid-feedback" th:if="${#fields.hasErrors('description')}" th:errors="*{description}">
                                    Erreur sur la description
                                </div>
                                <div class="form-text">
                                    <i class="bi bi-info-circle me-1"></i>
                                    Maximum 500 caractères - Optionnel
                                </div>
                            </div>

                            <!-- Album Info -->
                            <div class="alert alert-light border mb-4">
                                <div class="row g-3 small">
                                    <div class="col-md-4">
                                        <strong><i class="bi bi-images me-1"></i>Photos :</strong>
                                        <span th:text="${album.photoCount}">0</span>
                                    </div>
                                    <div class="col-md-4">
                                        <strong><i class="bi bi-calendar me-1"></i>Créé le :</strong>
                                        <span th:text="${#temporals.format(album.createdAt, 'dd/MM/yyyy')}">01/01/2024</span>
                                    </div>
                                    <div class="col-md-4">
                                        <strong><i class="bi bi-person me-1"></i>Propriétaire :</strong>
                                        <span th:text="${album.ownerUsername}">username</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Warning Box -->
                            <div class="alert alert-warning mb-4">
                                <div class="d-flex">
                                    <div class="flex-shrink-0">
                                        <i class="bi bi-exclamation-triangle fs-4"></i>
                                    </div>
                                    <div class="flex-grow-1 ms-3">
                                        <h6 class="alert-heading mb-2">Attention</h6>
                                        <p class="mb-0 small">
                                            Les photos de l'album ne seront pas affectées par ces modifications.
                                            Seuls le nom et la description seront modifiés.
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <!-- Action Buttons -->
                            <div class="d-flex gap-2 justify-content-between">
                                <a th:href="@{/albums/view/{id}(id=${album.id})}" class="btn btn-outline-secondary px-4">
                                    <i class="bi bi-x-circle me-2"></i>Annuler
                                </a>
                                <button type="submit" class="btn btn-primary px-4">
                                    <i class="bi bi-check-circle me-2"></i>Enregistrer les modifications
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Danger Zone -->
                <div class="card mt-4 border-danger">
                    <div class="card-header bg-danger text-white">
                        <h6 class="mb-0">
                            <i class="bi bi-exclamation-octagon me-2"></i>Zone dangereuse
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1">Supprimer cet album</h6>
                                <p class="text-muted small mb-0">
                                    Cette action est irréversible. Les photos ne seront pas supprimées.
                                </p>
                            </div>
                            <button type="button" 
                                    class="btn btn-outline-danger" 
                                    data-bs-toggle="modal" 
                                    data-bs-target="#deleteModal">
                                <i class="bi bi-trash me-1"></i>Supprimer
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="deleteModalLabel">
                        <i class="bi bi-exclamation-triangle me-2"></i>Confirmer la suppression
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="mb-3">
                        Êtes-vous sûr de vouloir supprimer définitivement l'album 
                        "<strong th:text="${album.name}">nom</strong>" ?
                    </p>
                    <div class="alert alert-info small mb-0">
                        <i class="bi bi-info-circle me-1"></i>
                        Les <strong th:text="${album.photoCount}">0</strong> photo(s) de l'album ne seront pas supprimées,
                        seulement l'album lui-même sera supprimé.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="bi bi-x me-1"></i>Annuler
                    </button>
                    <form th:action="@{/albums/delete/{id}(id=${album.id})}" method="post" class="d-inline">
                        <button type="submit" class="btn btn-danger">
                            <i class="bi bi-trash me-1"></i>Supprimer définitivement
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer th:replace="~{fragments/layout :: footer}"></footer>

    <!-- Scripts -->
    <th:block th:replace="~{fragments/layout :: scripts}"></th:block>

    <script>
        // Bootstrap form validation
        (function() {
            'use strict';
            var forms = document.querySelectorAll('.needs-validation');
            Array.prototype.slice.call(forms).forEach(function(form) {
                form.addEventListener('submit', function(event) {
                    if (!form.checkValidity()) {
                        event.preventDefault();
                        event.stopPropagation();
                    }
                    form.classList.add('was-validated');
                }, false);
            });
        })();

        // Character counter for name
        const nameInput = document.getElementById('name');
        const descriptionInput = document.getElementById('description');

        if (nameInput) {
            const updateNameCounter = () => {
                const remaining = 100 - nameInput.value.length;
                const helpText = nameInput.parentElement.querySelector('.form-text');
                if (helpText) {
                    helpText.innerHTML = '<i class="bi bi-info-circle me-1"></i>Maximum 100 caractères (' + remaining + ' restants)';
                }
            };
            nameInput.addEventListener('input', updateNameCounter);
            updateNameCounter(); // Initial update
        }

        if (descriptionInput) {
            const updateDescriptionCounter = () => {
                const remaining = 500 - descriptionInput.value.length;
                const helpText = descriptionInput.parentElement.querySelector('.form-text');
                if (helpText) {
                    helpText.innerHTML = '<i class="bi bi-info-circle me-1"></i>Maximum 500 caractères (' + remaining + ' restants)';
                }
            };
            descriptionInput.addEventListener('input', updateDescriptionCounter);
            updateDescriptionCounter(); // Initial update
        }
    </script>

    <style>
        .card {
            border-radius: 12px;
        }
        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        .alert-warning {
            background-color: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, #5568d3 0%, #63408a 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
    </style>
</body>
</html>